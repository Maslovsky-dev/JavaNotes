---
tags: Java/JDBC, SQL
---
JDBC (Java database connectivity)— это платформенно независимый промышленный стандарт взаимодействия Java-приложений с реляционными базами данных. Впервые был включен в состав JDK 1.1 в 1997 году. JDBC управляет:
- подключением к базе данных;
- выдачей запросов и команд;
- обработкой данных, полученных из базы.
## Как работает JDBC

Пакет JDBC состоит из двух главных компонентов:
1. **API** (программного интерфейса), который поддерживает связь между Java-приложением и менеджером JDBC;
2. **Драйвера JDBC,** который поддерживает связь между менеджером JDBC и драйвером базы данных.

Схема взаимодействия компонентов JDBC, базы данных и Java-приложения
## Классы вовлеченные в соединение с БД
DriverManager управляет всеми JDBC-драйверами в приложении. Представляет набор статических методов. Лениво загружает системным класс-лоадером доступные
Пред-сконфигурированные драйверы:
- По списку полных имен классов из проперти jdbc.drivers;
- Через Service Provider Interface (SPI).

Менеджер занимается созданием экземпляра **Connection** – ключевого класса при работе с базой данных. Альтернативный менеджеру (и даже рекомендуемый) способ соединения с источником данных – **ConnectionBuilder**. Билдер получают из javax.sql.DataSource – формально это часть Java EE, так что здесь не будем подробно на нем останавливаться.

**Driver** – главный класс реализации JDBC-драйвера. Когда загружается класслоадером, сам регистрирует себя в DriverManager. Так что кроме предсконфигурированных драйверов, дополнительные можно загрузить просто вызвав Class.forName.

Можно явно создавать **Connection** через драйвер, минуя менеджера и билдер. Драйвер предоставляет информацию о возможных/требуемых для своей работы свойствах в виде массива DriverPropertyInfo.

DriverAction – дополнительный интерфейс, который должен реализовывать Driver, если хочет получать уведомления о раз-регистрации DriverManager-ом.
## Этапы подключения к базе данных

1. Установка базы данных на сервер или выбор облачного сервиса, к которому нужно получить доступ.
2. Подключение библиотеки JDBC.
	*import java.sql.Connection;
	import java.sql.DriverManager;
	import java.sql.SQLException;
	import java.sql.ResultSet;
	import java.sql.Statement;*
- Driver;
- DatabaseMetaData.
		1. **Connection** подготавливает подключение к базе.
		2. **DriverManager** обеспечивает подключение. Другая опция — модуль DataSource.
		3. **SQLException** обрабатывает SQL-ошибки, возникающие при взаимодействии приложении и базы данных.
		4. **ResultSet** и **Statement** моделируют наборы результатов данных и операторы SQL._
3. Проверка факта нахождения необходимого драйвера JDBC в **classpath.**
	JDBC-драйвер — это класс, обеспечивающий взаимодействие интерфейса JDBC API с базой данных определенного типа. Драйвер для SQLite представляет собой .jar-файл. Можно подключить через maven
4. Установление соединения с базой данных с помощью библиотеки JDBC.
	`connection = DriverManager.getConnection(URL, USERNAME, PASSWORD);`
5. Использование установленного соединения для выполнения команд SQL.
	`Statement statement = connection.createStatement()`
6. Закрытие соединения после окончания сеанса.
	Util.closeConnection();
## DriverManager
Класс **DriverManager** является уровнем управления JDBC, отслеживает все доступные драйверы и управляет установлением соединений между БД и соответствующим драйвером.
### Загрузка драйвера JDBC
Чтобы сказать диспетчеру драйверов JDBC, какой именно драйвер следует загрузить, необходимо выполнить одну из команд :

1. Class.forName(“полное имя класса”)
2. Class.forName(“полное имя класса”).newInstance()
3. DriverManager.registerDriver(new “полное имя класса”)

Команды все равнозначны. Задача заключается в том, чтобы [**classloader**](https://java-online.ru/java-classloader.xhtml) загрузил нужный драйвер. Например :

`Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");`

Загрузка драйвера JDBC может производиться и другим способом. При вызове Java машины (JVM) можно указать в значении специального системного свойства **jdbc.drivers** название класса JDBC драйвера:

`java -Djdbc.drivers=sun.jdbc.odbc.JdbcOdbcDriver myClass`

В этом случае при первой попытке установления соединения с базой данных менеджер драйверов автоматически сам загрузит класс указанный в системном свойстве **jdbc.drivers**.
## Statement
**Statement** используется для выполнения SQL-запросов. Существует три типа класса Statement, которые являются как бы контейнерами для выполнения SQL-выражений через установленное соединение:
- Statement, базовый;
- PreparedStatement, наследующий от Statement;
- CallableStatement, наследующий от PreparedStatement.

### **Statement**
предназначен для выполнения простых SQL-запросов без параметров; содержит базовые методы для выполнения запросов и извлечения результатов.

Выполняется методом `execute` для обычного выражения, `executeUpdate` для модифицирующего, `executeBatch` для пакетного. Когда ожидаемый размер результата больше **Integer.MAX_VALUE**, используются версии
методов `executeLarge*`.

После выполнения, экземпляр **Statement** владеет **ResultSet**-ом, и другими данными о результате выполнения, такими как количество обновленных записей и сгенерированные ключи.

### **PreparedStatement**

Используется для выполнения SQL-запросов с или без входных параметров; добавляет методы управления входными параметрами.

Эффективнее выполняет одно и то же выражение множество раз за счет кэширования запросов. Входные параметры объявляются в SQL-выражении символом `?`, следом сеттерами задаются их типы и значения. Делегирует обязанность экранировать введенные пользователем параметры базе данных.

>[!note] Является предпочтительным для большинства случаев

[[Структура PreparedStatement]]
### **CallableStatement**
Используется для вызовов хранимых процедур; добавляет методы для манипуляции выходными параметрами.
## Создание объектов Statement

После установления соединения Connection с базой данных, оно может использоваться для выполнения SQL-запросов. Объект **Statement** создается методом Connection.createStatement.

### Пример:

``` java
Connection conn = DriverManager.getConnection(url, username, password);
Statement  stmt = conn.createStatement();
```

Для отправки серверу БД SQL-выражения для выполнения необходимо вызвать метод **executeQuery** объекта **Statement** и в качестве аргумента передать скрипт запроса:

`ResultSet rs = stmt.executeQuery("SELECT * FROM USERS");`

## ResultSet
Класс ResultSet представляет результирующий набор данных и обеспечивает приложению построчный доступ к результатам запросов. При обработке запроса _ResultSet_ поддерживает указатель на текущую обрабатываемую строку.

Доступ к данным **ResultSet** обеспечивает посредством набора get-методов, которые организуют доступ к колонкам текущей строки. Метод ResultSet.next используется для перемещения к следующей строке ResultSet, делая ее текущей.
[Методы ResultSet](https://java-online.ru/jdbc-resultset.xhtml)
