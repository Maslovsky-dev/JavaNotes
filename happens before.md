---
tags: Java/Многопоточность
--- 
В модели памяти Java существуют определенные правила отношения "happens-before", которые гарантируют правильное поведение многопоточных программ:

>[!Info] 
>Happens-before («выполняется прежде» или «произошло-до») — отношение порядка между атомарными командами. Оно означает, что **вторая команда будет видеть изменения первой команды, и что первая команды выполнилась перед второй**.

1. **Порядок программы (Program Order)**: Операции в одном потоке, которые появляются в программе в определенном порядке, будут видны в том же порядке другим операциям в этом потоке. Это означает, что код, записанный в программе до вызова метода `B`, происходит до кода внутри метода `B` в том же потоке.
2. **Захват и освобождение монитора (Monitor Lock)**: Когда один поток захватывает монитор объекта и входит в синхронизированный блок кода, а затем освобождает монитор, другой поток, который затем захватывает этот же монитор, будет видеть все изменения, сделанные первым потоком внутри блока кода. Это создает отношение "happens-before" между операциями захвата и освобождения монитора.
3. **Взаимодействие с volatile переменными**: Запись в переменную типа `volatile` в одном потоке гарантирует, что все потоки, читающие эту переменную, будут видеть последнее записанное значение. Это создает отношение "happens-before" между записью в `volatile` переменную и последующими чтениями этой переменной.
4. **Ожидание потоков ([[Thread join|Thread Join]])**: Вызов метода `join()` на потоке A и его успешное завершение гарантируют, что все изменения, сделанные потоком A, будут видны потоку, вызывающему `join()`. Это также создает отношение "happens-before".
5. **Передача задач через Executor и Thread**: Задачи, переданные через исполнитель (`Executor`) или поток (`Thread`), гарантируют, что любые изменения, сделанные в одной задаче, будут видны другим задачам, которые получают эту задачу на выполнение. Это также создает отношение "happens-before".

Отношение "happens-before" является важным для обеспечения правильного порядка выполнения операций в многопоточной среде и предотвращения гонок данных и других проблем согласованности памяти.
