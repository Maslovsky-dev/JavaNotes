---
tags: Web
---
Протокол HTTP протокол прикладного уровня (на ряду с SNMP, POP3, FTP, Modbus, SIP ,TELNET)

![[Определение HTTP протокола.png]]

Основные [[Версии протокола HTTP]] - 1.0, 1.1 и 2.0.
## Основные понятия
Получение доступа к ресурсам по HTTP-протоколу осуществляется с помощью указателя URL (Uniform Resource Locator). URL представляет собой строку, которая позволяет указать запрашиваемый ресурс и еще ряд параметров.

Использование URL неразрывно связано с другими элементами протокола, поэтому далее мы рассмотрим его основные компоненты и строение:

Поле **Scheme** используется для указания используемого протокола, всегда сопровождается двоеточием и двумя косыми чертами (://).

**Host** указывает местоположение ресурса, в нем может быть как доменное имя, так и IP-адрес. [[DNS]]

**Port**, как можно догадаться, позволяет указать номер порта, по которому следует обратиться к серверу. Оно начинается с двоеточия (:), за которым следует номер порта. При отсутствии данного элемента номер порта будет выбран по умолчанию в соответствии с указанным значением **Scheme** (например, для http:// это будет порт 80).

Далее следует поле **Path**. Путь к контроллеру, end point
Оно указывает на ресурс, к которому производится обращение. Если данное поле не указано, то сервер в большинстве случаев вернет указатель по умолчанию (например index.html).

Поле **Query String** начинается со знака вопроса (?), за которым следует пара «параметр-значение», между которыми расположен символ равно (=). В поле Query String могут быть переданы несколько параметров с помощью символа амперсанд (&) в качестве разделителя.

Не все компоненты необходимы для доступа к ресурсу. Обязательно следует указать только поля **Scheme** и **Host**.
## Структура HTTP запроса, ответа

HTTP-запросы **состоят из начальной строки, заголовков и необязательного тела**.
Начальная строка содержит метод HTTP, URL запрашиваемого ресурса и используемую версию HTTP.

### **Стартовая строка** (англ. Starting line)
— определяет тип сообщения;

Стартовая строка HTTP-запроса состоит из трех элементов:

1. **Метод HTTP-запроса** (method, реже используется термин verb). Обычно это короткое слово на английском, которое указывает, что конкретно нужно сделать с запрашиваемым ресурсом. Например, метод GET сообщает серверу, что пользователь хочет получить некоторые данные, а POST — что некоторые данные должны быть помещены на сервер.
2. **Цель запроса**. Представлена указателем ресурса URL, который состоит из протокола, доменного имени (или IP-адреса), пути к конкретному ресурсу на сервере. Дополнительно может содержать указание порта, несколько параметров HTTP-запроса и еще ряд опциональных элементов.
3. **Версия используемого протокола** (либо HTTP/1.1, либо HTTP/2), которая определяет структуру следующих за стартовой строкой данных.

В примере ниже стартовая строка указывает, что в качестве метода используется GET, обращение будет произведено к ресурсу /index.html, по версии протокола HTTP/1.1:

![структурные элементы](https://selectel.ru/blog/wp-content/uploads/2022/06/image.png)
	Пример стартовой строки запроса выглядит так:
	`GET URI` — для версии протокола 0.9;
	`Метод URI HTTP/Версия` — для остальных версий.

### **Заголовки** (англ. Headers)
— характеризуют тело сообщения, параметры передачи и прочие сведения;
**HTTP-заголовок** представляет собой строку формата «Имя-Заголовок:Значение», с двоеточием(:) в качестве разделителя. Название заголовка не учитывает регистр, то есть между Host и host, с точки зрения HTTP, нет никакой разницы. Однако в названиях заголовков принято начинать каждое новое слово с заглавной буквы. Структура значения зависит от конкретного заголовка. Несмотря на то, что заголовок вместе со значениями может быть достаточно длинным, занимает он всего одну строчку.

В запросах может передаваться большое число различных заголовков, но все их можно разделить на три категории:

1. **Общего назначения**, которые применяются ко всему сообщению целиком.
2. **Заголовки запроса** уточняют некоторую информацию о запросе, сообщая дополнительный контекст или ограничивая его некоторыми логическими условиями.
3. **Заголовки представления**, которые описывают формат данных сообщения и используемую кодировку. Добавляются к запросу только в тех случаях, когда с ним передается некоторое тело.

Ниже можно видеть пример заголовков в запросе:

![методы запроса](https://selectel.ru/blog/wp-content/uploads/2022/06/image-2.png)

##### Самые частые заголовки запроса

|**Заголовок**|**Описание**|
|---|---|
|**Host**|Используется для указания того, с какого конкретно хоста запрашивается ресурс. В качестве возможных значений могут использоваться как доменные имена, так и IP-адреса. На одном HTTP-сервере может быть размещено несколько различных веб-сайтов. Для обращения к какому-то конкретному требуется данный заголовок.|
|**User-Agent**|Заголовок используется для описания клиента, который запрашивает ресурс. Он содержит достаточно много информации о пользовательском окружении. Например, может указать, какой браузер используется в качестве клиента, его версию, а также операционную систему, на которой этот клиент работает.|
|**Refer**|Используется для указания того, откуда поступил текущий запрос. Например, если вы решите перейти по какой-нибудь ссылке в этой статье, то вероятнее всего к запросу будет добавлен заголовок Refer: https://selectel.ru|
|**Accept**|Позволяет указать, какой тип медиафайлов принимает клиент. В данном заголовке могут быть указаны несколько типов, перечисленные через запятую (‘ , ‘). А для указания того, что клиент принимает любые типы, используется следующая последовательность — */*.|
|**Cookie**|Данный заголовок может содержать в себе одну или несколько пар «Куки-Значение» в формате cookie=value. Куки представляют собой небольшие фрагменты данных, которые хранятся как на стороне клиента, так и на сервере, и выступают в качестве идентификатора. Куки передаются вместе с запросом для поддержания доступа клиента к ресурсу. Помимо этого, куки могут использоваться и для других целей, таких как хранение пользовательских предпочтений на сайте и отслеживание клиентской сессии. Несколько кук в одном заголовке могут быть перечислены с помощью символа точка с запятой (‘ ; ‘), который  используется как разделитель.|
|**Authorization**|Используется в качестве еще одного метода идентификации клиента на сервере. После успешной идентификации сервер возвращает токен, уникальный для каждого конкретного клиента. В отличие от куки, данный токен хранится исключительно на стороне клиента и отправляется клиентом только по запросу сервера. Существует несколько типов аутентификации, конкретный метод определяется тем веб-сервером или веб-приложением, к которому клиент обращается за ресурсом.|

### **Тело сообщения** (англ. Message Body)
— непосредственно данные сообщения.
Обязательно должно отделяться от заголовков пустой строкой.

Завершающая часть HTTP-запроса — это его тело. Не у каждого HTTP-метода предполагается наличие тела. Так, например, методам вроде GET, HEAD, DELETE, OPTIONS обычно не требуется тело. Некоторые виды запросов  могут отправлять данные на сервер в теле запроса: самый распространенный из таких методов — POST.

## HTTP Методы:
HTTP-методы включают GET, POST, PUT, DELETE и другие. GET используется для запроса ресурса, POST используется для отправки данных на сервер, PUT используется для загрузки файла, а DELETE используется для удаления ресурса.

|**Метод**|**Описание**|
|---|---|
|**GET**|Позволяет запросить некоторый конкретный ресурс. Дополнительные данные могут быть переданы через строку запроса (Query String) в составе URL (например ?param=value).О составляющих URL мы поговорим чуть позже.|
|**POST**|Позволяет отправить данные на сервер. Поддерживает отправку различных типов файлов, среди которых текст, PDF-документы и другие типы данных в двоичном виде. Обычно метод POST используется при отправке информации (например, заполненной формы логина) и загрузке данных на веб-сайт, таких как изображения и документы.|
|**HEAD**|Здесь придется забежать немного вперед и сказать, что обычно сервер в ответ на запрос возвращает заголовок и тело, в котором содержится запрашиваемый ресурс. Данный метод при использовании его в запросе позволит получить только заголовки, которые сервер бы вернул при получении GET-запроса к тому же ресурсу. Запрос с использованием данного метода обычно производится для того, чтобы узнать размер запрашиваемого ресурса перед его загрузкой.|
|**PUT**|Используется для создания (размещения) новых ресурсов на сервере. Если на сервере данный метод разрешен без надлежащего контроля, то это может привести к серьезным проблемам безопасности.|
|**DELETE**|Позволяет удалить существующие ресурсы на сервере. Если использование данного метода настроено некорректно, то это может привести к атаке типа «Отказ в обслуживании» (Denial of Service, DoS) из-за удаления критически важных файлов сервера.|
|**OPTIONS**|Позволяет запросить информацию о сервере, в том числе информацию о допускаемых к использованию на сервере HTTP-методов.|
|**PATCH**|Позволяет внести частичные изменения в указанный ресурс по указанному расположению.|

[[Отличия POST и PUT и PATCH методов HTTP]]

### Безопасность и идемпотентность запросов
Безопасный запрос - это запрос, который не меняет состояние приложения.
Идемпотентный запрос - это запрос, эффект которого от многократного выполнения равен эффекту от однократного выполнения.
![[Безопасность и идемпотентность запросов HTTP протокола.png]]
POST - не идемпотентен, остальные - ДА! Пример - email (если один адрес уже создали, то другой не создать)
	 Например, вы поздоровались с утра с человеком, сказав ему «Привет!» В результате ваш знакомый переходит в состояние «поздорованный» :-) И если вы ещё несколько раз в течение дня ему скажете «Привет!», ничего не изменится, **он останется в том же состоянии**.
>[!Note]
>Идемпотентность не гарантирует. Что получим такой же ответ.
Например, используя метод DELETE, первый раз объект удалили, а второй раз получили 404 not found… И, хотя состояние объекта не изменилось, но получили другой ответ.\ То есть ответ может менять в зависимости от операции.

### Как сделать POST идемпотентным?
Cделать метод PUT и настроить проверку

## Ответы HTTP
**HTTP-ответ** является сообщением, которое сервер отправляет клиенту _в ответ_ на его запрос. Его структура равна структуре HTTP-запроса: стартовая строка, заголовки и тело.
##### **Строка статуса (Status line)**

Стартовая строка HTTP-ответа называется **строкой статуса** (status line). На ней располагаются следующие элементы:

1. Уже известная нам по стартовой строке запроса _версия протокола_ (HTTP/2 или HTTP/1.1).
2. _Код состояния_, который указывает, насколько успешно завершилась обработка запроса.
3. _Пояснение_ — короткое текстовое описание к коду состояния. Используется исключительно для того, чтобы упростить понимание и восприятие человека при просмотре ответа.
![строка состояния ответа](https://selectel.ru/blog/wp-content/uploads/2022/06/image2-1-1525x1079.png)
##### Коды состояния и текст статуса

Коды состояния HTTP используются для того, чтобы сообщить клиенту статус их запроса. HTTP-сервер может вернуть код, принадлежащий одной из пяти категорий кодов состояния:

|**Категория**|**Описание**|
|---|---|
|**1xx**|Коды из данной категории носят исключительно информативный характер и никак не влияют на обработку запроса.|
|**2xx**|Коды состояния из этой категории возвращаются в случае успешной обработки клиентского запроса.|
|**3xx**|Эта категория содержит коды, которые возвращаются, если серверу нужно перенаправить клиента.|
|**4xx**|Коды данной категории означают, что на стороне клиента был отправлен некорректный запрос. Например, клиент в запросе указал не поддерживаемый метод или обратился к ресурсу, к которому у него нет доступа.|
|**5xx**|Ответ с кодами из этой категории приходит, если на стороне сервера возникла ошибка.|

Полный список кодов состояния доступен в спецификации к протоколу, ниже приведены только самые распространенные коды ответов:

| **Категория**          | **Описание**                                                                                                                                                                                       |
| ---------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **200 OK**             | Возвращается в случае успешной обработки запроса, при этом тело ответа обычно содержит запрошенный ресурс.                                                                                         |
| **302 Found**          | Перенаправляет клиента на другой URL. Например, данный код может прийти, если клиент успешно прошел процедуру аутентификации и теперь может перейти на страницу своей учетной записи.              |
| **400 Bad Request**    | Данный код можно увидеть, если запрос был сформирован с ошибками. Например, в нем отсутствовали символы завершения строки.                                                                         |
| **403 Forbidden**      | Означает, что клиент не обладает достаточными правами доступа к запрошенному ресурсу. Также данный код можно встретить, если сервер обнаружил вредоносные данные, отправленные клиентом в запросе. |
| **404 Not Found**      | Каждый из нас, так или иначе, сталкивался с этим кодом ошибки. Данный код можно увидеть, если запросить у сервера ресурс, которого не существует на сервере.                                       |
| **500 Internal Error** | Данный код возвращается сервером, когда он не может по определенным причинам обработать запрос.                                                                                                    |


##### Заголовки ответа

Response Headers, или заголовки ответа, используются для того, чтобы уточнить ответ, и никак не влияют на содержимое тела. Они существуют в том же формате, что и остальные заголовки, а именно  «Имя-Значение» с двоеточием (:) в качестве разделителя.

Ниже приведены наиболее часто встречаемые в ответах заголовки:

|**Категория**|**Пример**|**Описание**|
|---|---|---|
|**Server**|Server: ngnix|Содержит информацию о сервере, который обработал запрос.|
|**Set-Cookie**|Set-Cookie:PHPSSID=bf42938f|Содержит куки, требуемые для идентификации клиента. Браузер парсит куки и сохраняет их в своем хранилище для дальнейших запросов.|
|**WWW-Authenticate**|WWW-Authenticate: BASIC realm=»localhost»|Уведомляет клиента о типе аутентификации, который необходим для доступа к запрашиваемому ресурсу.|

##### Тело ответа

Последней частью ответа является его тело. Несмотря на то, что у большинства ответов тело присутствует, оно не является обязательным. Например, у кодов «201 Created» или «204 No Content» тело отсутствует, так как достаточную информацию для ответа на запрос они передают в заголовке.

## Размер данных которые могут передаваться через GET и POST запросы
Размер данных, которые могут передаваться через GET и POST запросы, зависит от настроек браузера и сервера. [Общий безопасный размер для GET - 2 КБ, так как почти нет браузеров или серверов, которые используют меньший лимит](https://stackoverflow.com/questions/2364840/what-is-the-size-limit-of-an-http-post-request). Для POST лимит может быть выше, но также настраивается на сервере. [Обычно он составляет около 8 МБ](https://stackoverflow.com/questions/2364840/what-is-the-size-limit-of-an-http-post-request), но может достигать до 4 ГБ](https://stackoverflow.com/questions/2659952/maximum-length-of-http-get-request). [GET поддерживает только строковые типы данных, а POST - разные типы данных, такие как строковые, числовые, бинарные и т.д.](https://sage-advices.com/what-are-the-size-limits-of-get-and-post/).

### Сжатие данных запроса
HTTP протокол поддерживает сжатие данных запроса, что может помочь сэкономить трафик и ускорить передачу данных. Для этого используются разные алгоритмы сжатия, такие как gzip, deflate или brotli. Сжатие данных запроса поддерживается большинством современных браузеров и серверов, но требует указания соответствующих заголовков HTTP .

Сжатие данных запроса может быть включено или выключено администратором сервера.
## Безопасность протокола
HTTP протокол не является безопасным протоколом по умолчанию. Это означает, что данные, передаваемые по HTTP, могут быть перехвачены и прочитаны любым пользователем, который имеет доступ к сети. Для обеспечения безопасности передачи данных по HTTP необходимо использовать протокол HTTPS.

HTTPS - это безопасный вариант HTTP, который использует шифрование с помощью сертификатов [[SSL]]/TLS для защиты данных от перехвата. HTTPS является рекомендуемым вариантом для передачи данных, которые чувствительны к безопасности, таких как данные кредитных карт или пароли.
