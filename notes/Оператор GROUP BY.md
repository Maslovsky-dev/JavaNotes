---
tags: SQL
--- 
## Общая структура запроса с GROUP BY]

```sql
SELECT [литералы, агрегатные_функции, поля_группировки]
FROM имя_таблицы
GROUP BY поля_группировки
```
Для того, чтобы записи у нас образовали группы по типу жилья мы должны после GROUP BY указать home_type, т.е. поле, по которому будет происходить группировка.
```sql
SELECT home_type FROM Rooms
GROUP BY home_type  /* тип дома */
```

>[!NOTE] Для GROUP BY все значения NULL трактуются как равные, 
>При группировке по полю, содержащему NULL-значения, все такие строки попадут в одну группу


При использовании оператора GROUP BY мы перешли от работы с отдельными записями на работу с образовавшимися группами. В связи с этим мы не можем просто вывести любое поле из записи (например, has_tv или price), как мы это могли делать раньше. Так как в каждой группе может быть несколько записей и в каждой из них в этом поле может быть разное значение.

При использовании GROUP BY мы можем выводить только:

- литералы, т.е. указанное явным образом фиксированные значения.
    Мы можем их выводить, так как это фиксированные значения, которые ни от чего не зависят.  
    Например,

```sql
SELECT home_type, "literal" FROM Rooms
GROUP BY home_type
```

| home_type       | literal |
| --------------- | ------- |
| Private room    | literal |


- результаты [[Агрегатные функции|агрегатных функций]], т.е. вычисленные значения на основании набора значений. 
    Функция AVG принимает в качестве аргумента название поля, по которому мы хотим вычислить среднее значение для каждой группы.

```sql
SELECT home_type, AVG(price) as avg_price FROM Rooms
GROUP BY home_type
```

|home_type|avg_price|
|---|---|
|Private room|89.4286|
|Entire home/apt|148.6667|
|Shared room|40|

- поля группировки.
    
    Мы можем их выводить, так как в рамках одной группы поля, по которым осуществлялась группировка, одинаковые.

## Группировка по 2-м и более полям
  
![Группировка по 2 полям](https://sql-academy.org/static/guidePage/groupping/groupping_by_2_field.png "Группировка по 2 полям")
