---
tags: SQL
---
## Как оценить сложность выполняемого запроса?

Стоимостной оптимизатор делает расчёт на основании двух показателей:
- **page_cost**, измеряется в единицах стоимости 1.0 – сколько страниц нужно считать для выполнения одного запроса (input-output).
- **сpu_cost** – как много операций сделал процессор для выполнения запроса.
Например, прошлись по строчке, считали информацию одной записи в таблице.
Стоимость будет 0,01.

В PostgreSQL есть специальная таблица **pg_class**, которая хранит статистические данные, на основании которых базируется работа стоимостного оптимизатора.

## Анализ выполнения запроса (если есть проблемы с производительностью)
![[EXPLAIN операция sql.png]]
![[Пример выполнения EXPLAIN sql.png]]
- [ ] что выдает explain
## Как узнать, сколько места занимает таблица в памяти?

Команда `SHOW TABLE STATUS`: В MySQL или MariaDB вы можете выполнить команду `SHOW TABLE STATUS`, указав имя таблицы, чтобы получить информацию о таблице, включая размер данных и индексов. В столбце `Data_length` будет указан размер данных таблицы, а в столбце `Index_length` - размер индексов таблицы. Сумма этих двух значений даст общий размер таблицы в байтах.

## Методы сканирования таблиц

![[Методы сканирования таблиц.png]]

## Что такое индексы?
[[Индексы SQL]]

## Хранимые процедуры
Хранимые процедуры позволяют повысить производительность, расширяют возможности программирования и поддерживают функции безопасности данных. В большинстве СУБД при первом запуске хранимой процедуры она компилируется (выполняется синтаксический анализ и генерируется план доступа к данным) и в дальнейшем её обработка осуществляется быстрее.

Хранимая процедура — объект базы данных, представляющий собой набор SQL-инструкций, который хранится на сервере. Хранимые процедуры очень похожи на обыкновенные процедуры языков высокого уровня, у них могут быть входные и выходные параметры и локальные переменные, в них могут производиться числовые вычисления и операции над символьными данными, результаты которых могут присваиваться переменным и параметрам. В хранимых процедурах могут выполняться стандартные операции с базами данных (как DDL, так и DML). Кроме того, в хранимых процедурах возможны циклы и ветвления, то есть в них могут использоваться инструкции управления процессом исполнения.

Хранимые процедуры позволяют повысить производительность, расширяют возможности программирования и поддерживают функции безопасности данных. В большинстве СУБД при первом запуске хранимой процедуры она компилируется (выполняется синтаксический анализ и генерируется план доступа к данным) и в дальнейшем её обработка осуществляется быстрее.

## Триггер (trigger)
Это хранимая процедура особого типа, которую пользователь не вызывает непосредственно, а исполнение которой обусловлено действием по модификации данных: добавлением, удалением или изменением данных в заданной таблице реляционной базы данных. Триггеры применяются для обеспечения целостности данных и реализации сложной бизнес-логики.

Триггер **запускается сервером автоматически** и все производимые им модификации данных рассматриваются как выполняемые в транзакции, в которой выполнено действие, вызвавшее срабатывание триггера. Соответственно, в случае обнаружения ошибки или нарушения целостности данных может произойти откат этой транзакции.

Момент запуска триггера определяется с помощью ключевых слов **BEFORE** (триггер запускается до выполнения связанного с ним события) или **AFTER** (после события). В случае, если триггер вызывается до события, он может внести изменения в модифицируемую событием запись.

Триггеры могут быть привязаны не к таблице, а к представлению (**VIEW**). В этом случае с их помощью реализуется механизм «обновляемого представления». В этом случае ключевые слова BEFORE и AFTER влияют лишь на последовательность вызова триггеров, так как собственно событие (удаление, вставка или обновление) не происходит.
