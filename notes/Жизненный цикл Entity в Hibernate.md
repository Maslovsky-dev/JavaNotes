---
tags: ORM
---
[[Persistence Context]]
1. Transient.  
В этом состоянии находятся заполненные экземпляры классов-сущностей. Они не подключены к сессии и поле Id у них не должно быть заполнено, иначе объект имеет состояние detached;  
2. Persistent  
Объект в данном состоянии, иначе называемый хранимая сущность, присоединен **к конкретной сессии** и взаимодействует с БД. При работе с объектом данного типа в рамках транзакции все изменения объекта записываются в базу;  
3. Detached.  
Объект в данном состоянии отсоединён от сессии и может существовать или не существовать в БД.

![[Диаграмма жизненного цикла сущности в Hibernate.png]]
## Этап №1 New, переходное состояние (Transient State)
Объект создан, не имеет primary key, не является частью контекста персистентности (не управляется JPA);
![[Transient состояние объекта.png|400]]

Переходное состояние — это первое состояние объекта сущности. Когда мы создаем объект POJO класса с помощью оператора new, объект находится в переходном состоянии. Этот объект не связан ни с одной сессией, следовательно, это состояние не связано ни с одной таблицей БД. Итак, если мы внесем какие-либо изменения в данные класса POJO, таблица базы данных не изменится. Временные объекты не зависят от Hibernate и существуют в куче памяти.

## Этап №2 Managed, постоянное состояние (Persistent State)
Объект создан, имеет primary key, является частью контекста персистентности (управляется JPA);
![[Persistent состояние.png|200]]
Как только объект подключается к сессии, он переходит в постоянное состояние.
Есть два способа преобразовать переходное состояние в постоянное состояние: 
- Используя сессию, сохранить объект сущности в таблице базы данных. 
- Используя сессию, загрузить объект сущности в таблицу базы данных.

В этом состоянии каждый объект представляет собой одну строку в таблице БД. Следовательно, если внести какие-либо изменения в данные, то hibernate обнаружит это и внесет изменения в таблицу базы данных.

## Этап №3 Detached, отсоединённое состояние (Detached State)
Объект создан, имеет primary key, не является (или больше не является) частью контекста персистентности (не управляется JPA);

Для преобразования объекта из постоянного в отсоединенное состояние нужно либо закрыть сессию, либо очистить кэш. Поскольку сессия будет закрыта или кеш очищен, любые изменения, внесенные в данные, не повлияют на таблицу базы данных. При необходимости отсоединенный объект можно повторно подключить к новой сессии.
![[Detached состояние.png]]

## Этап №4 Removed, состояние «удалено» (Removed State)
Объект создан, является частью контекста персистентности (управляется JPA), будет удален при commit-е транзакции (закрытии сессии или вызове метода flush()).
![[Deleted state.png]]

## Как влияют операции persist, remove, merge, refresh, detach на Entity объекты каждого из четырех статусов?
![[Операции CRUD и состояния объектов.png]]
