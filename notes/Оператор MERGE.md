---
tags: SQL
--- 
Оператор MERGE в SQL используется для выполнения операции слияния (обновления или вставки) данных в целевую таблицу на основе данных из исходной таблицы или подзапроса. Он позволяет объединить операции INSERT, UPDATE и DELETE в одном операторе.

Синтаксис оператора MERGE выглядит следующим образом:

```sql
MERGE INTO target_table USING source_table ON merge_condition WHEN MATCHED THEN     UPDATE SET column1 = value1, column2 = value2, ... WHEN NOT MATCHED THEN     INSERT (column1, column2, ...) VALUES (value1, value2, ...)
```

Оператор MERGE состоит из следующих частей:

- `target_table`: имя целевой таблицы, в которую будут вставлены или обновлены данные.
- `source_table` или подзапрос: исходная таблица или подзапрос, данные из которого будут использоваться для слияния.
- `merge_condition`: условие соответствия для объединения строк из целевой и исходной таблицы.
- `WHEN MATCHED THEN UPDATE`: определяет, какие столбцы будут обновлены в целевой таблице при соответствии условию.
- `WHEN NOT MATCHED THEN INSERT`: определяет, какие столбцы будут вставлены в целевую таблицу, когда условие не соответствует.

Ограничения оператора MERGE:

1. MERGE может быть использован только для слияния данных в одной целевой таблице.
2. MERGE требует, чтобы таблицы, участвующие в операции, имели соответствующие столбцы и типы данных.
3. MERGE требует, чтобы у целевой таблицы были права на выполнение операций INSERT, UPDATE и DELETE.
4. MERGE может выполняться только в рамках одной транзакции.
5. MERGE может привести к блокировке ресурсов, поэтому следует быть осторожным при использовании его в многопоточных или распределенных средах.

Оператор MERGE полезен, когда требуется объединить операции обновления и вставки данных в одном запросе, особенно при слиянии данных из разных источников в целевую таблицу.
