---
tags: Java/Многопоточность
---
В программировании термин "монитор" относится к механизму синхронизации, который используется для контроля доступа к общим ресурсам в многопоточной среде. **Монитор гарантирует, что только один поток может одновременно выполнять код, защищенный монитором.**

В Java монитор реализован с помощью ключевого слова `synchronized` и объектов-мониторов. Когда блок кода помечен ключевым словом `synchronized` или метод объявлен с модификатором `synchronized`, **объект**, на котором вызывается блок кода или метод, **становится монитором**, который синхронизирует доступ к этому коду.

## Формы мониторов в java
1. **[[Семафор в Java|Семафор]]** (Semaphores): Семафоры позволяют контролировать количество потоков, которым разрешено одновременно получать доступ к определенному ресурсу или критическому участку кода.
2. **Блокировки** (Locks): Блокировки - это альтернативный механизм синхронизации, который предоставляет более гибкую и расширенную функциональность по сравнению с ключевым словом `synchronized`. Блокировки позволяют управлять состоянием блокировки, реентерабельностью (возможностью потока повторно захватить блокировку, которую он уже удерживает) и попытками получить блокировку с тайм-аутом.
3. **Условные переменные** (Condition Variables): Условные переменные позволяют потокам синхронизироваться и ожидать определенного условия. Они позволяют потокам ждать, пока другие потоки не выполнят определенные действия или не изменят состояние общих данных.
4. **Барьеры** (Barriers): Барьеры представляют собой точки синхронизации, в которых несколько потоков должны остановиться и дождаться, пока все они достигнут барьера, прежде чем продолжить выполнение.
5. **[[Mutex|Мьютексы]]** (Mutexes): Мьютексы представляют собой блокировки, которые используются для обеспечения взаимного исключения и контроля доступа к общим ресурсам. Они являются основным механизмом монитора и обеспечивают возможность только одному потоку входить в критическую секцию кода.

Это лишь некоторые формы монитора и механизмы синхронизации, доступные в многопоточных системах. Выбор конкретного механизма зависит от требований приложения и характеристик конкретной ситуации синхронизации.
## Mutex
Частью монитора является [[Mutex|mutex]], который встроен в класс Object и имеется у каждого объекта.
>[!Note] Блокировка потока происходит на уровне ОБЪЕКТА (mutex)

![[Waitable Mutex.png|400]]
Удобно представлять mutex как **id захватившего его объекта** (одноместный семафор).
- Если этот id равен 0, то ресурс свободен.
- Если этот id НЕ равен 0, то ресурс занят: встать в очередь и ждать освобождения.

В Java монитор реализован с помощью ключевого слова **synchronized**.

## Что является монитором у статического синхронизированного класса?
У статического синхронизированного класса в Java монитором является **сам класс, а не его экземпляры**.

Когда вы объявляете статический метод или блок с ключевым словом `synchronized` внутри класса, монитором для синхронизации служит класс в целом. Это означает, что при использовании синхронизации на статическом уровне, потоки будут конкурировать за доступ к классу в целом.

При использовании статического синхронизированного метода или блока, только один поток может одновременно получить доступ к этому методу или блоку внутри класса. Остальные потоки будут ожидать, пока ресурс не будет освобожден текущим потоком.
## Что является монитором у не статического синхронизированного класса?
У нестатического синхронизированного класса в Java **монитором является экземпляр этого класс**а.

Когда вы объявляете нестатический метод или блок с ключевым словом `synchronized` внутри класса, монитором для синхронизации служит конкретный экземпляр этого класса. Это означает, что при использовании синхронизации на нестатическом уровне, потоки будут конкурировать за доступ к конкретному экземпляру класса.

При использовании нестатического синхронизированного метода или блока, только один поток может одновременно получить доступ к этому методу или блоку внутри экземпляра класса. Другие потоки будут ожидать, пока ресурс не будет освобожден текущим потоком.
