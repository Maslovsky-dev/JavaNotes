---
tags: SQL
---
## Типы связей между таблицами


| Вид связи  | Описание                                                                                                 | Пример                                                                                                               | Тип загрузки по умолчанию |
|------------|----------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------|---------------------------|
| **OneToOne**   | один экземпляр Entity может быть связан не больше, чем с одним экземпляром другого Entity                | У пользователя может быть только один профиль (Госуслуги). Профиль на госуслугах связан только с одним пользователем | EAGER                     |
| **OneToMany**  | один экземпляр Entity может быть связан с несколькими экземплярами других Entity (коллекцией сущностей)  | Один пользоваль может иметь несколько мобильных номеров телефона. При этом у отдельного номера только один владелец  | LAZY                      |
| **ManyToOne**  | Несколько экземпляров Entity (коллекция сущностей) могут быть связаны с одним экземпляром другого Entity | Много студентов учатся на оной кафедре                                                                               | EAGER                     |
| **ManyToMany** | экземпляры Entity могут быть связаны с несколькими экземплярами друг друга                               | Много студентов учатся у разных (многих) преподавателей                                                              | LAZY                      |

**Первое слово относится к классу Entity, второе к полю в этом классе (ассоциации).**

## @OneToOne
Для связи один к одному в обоих классах к соответствующим полям добавляется аннотация **@OneToOne**. Параметр *optional* говорит JPA, является ли значение в этом поле обязательным или нет. Аннотации **@JoinColumn** указывает, что поле является внешним ключом другой таблицы

Для того чтобы объявить сторону, которая не несет ответственности за отношения, используется атрибут **mappedBy** (обратная ссылка)

Со стороны владельца к аннотации **@OneToOne** добавляется параметр *cascade*. В однонаправленных отношениях одна из сторон (и только одна) должна быть владельцем и нести ответственность за обновление связанных полей. Каскадирование позволяет указать JPA, что необходимо «сделать со связанным объектом при выполнении операции с владельцем».
## @ManyToMany
В случае отношения «многие ко многим» обе стороны могут относиться к нескольким экземплярам другой стороны.
Моделирование отношений «многие ко многим» с помощью POJO очень просто. Мы должны включить в оба класса коллекцию , которая содержит элементы других.

Кроме того, мы должны настроить тип отношения чтобы Hibernate понял, что мы хотим создать именно двустороннее отношение нам нужно указать, какая из сторон является владельцем отношений, а какая является обратной стороной. Это делается при помощи атрибута *mappedBy*.

Для отношения многие ко многим любая из сторон может быть владельцем. В случае с ролями и пользователями выберем сущность пользователя в качестве владельца.
В зависимости от *cascade* будет либо учитываться связь между сущностями для выполнения операции, либо нет.

cascade=ALL - на все операции
cascade={PERSIST, MERGE, REMOVE, REFRESH, DETACH} - на определенные операции,
те что есть в перечислении будут учитываться.

## Направления связей (unidirectional и bidirectional)

## Однонаправленные

Uni-directional associations: одна сторона знает про отношения, а другая нет. Однонаправленные отношения имеют только одного владельца связи.
![[Пример однонаправленных отношений OneToOne.png]]
![[Пример однонаправленных отношений OneToMany.png]]
## Двунаправленные
Bi-directional associations: каждая сущность имеет поле, которое
ссылается на другую сущность. Через это поле код первой сущности может получить доступ ко второй сущности, находящейся на другой стороне отношений.
![[Пример ManyToOne двунаправленной связи.png]]
![[Пример ManyToMany двунаправленной связи.png]]
## Владелец связи
![[Владелец связи summary.png]]
