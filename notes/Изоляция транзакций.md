---
tags:
  - SQL
---
### Уровни изолированности транзакций
Уровень изолированности транзакций — условное значение, определяющее, в какой мере в результате выполнения логически параллельных транзакций в СУБД допускается получение несогласованных данных.

>[!info]
>Другими словами, выбираем между высокой **согласованностью данных** между транзакциями и **скоростью выполнения** этих транзакций


- **Serializable** (Сериализуемость) - очередь из транзакций, последовательное их выполнение. Низкая производительность, но самая высокая согласованность данных

- **Read commited** (Чтение зафиксированных данных) - одна транзакция видит изменения, которые сделала другая транзакция с помощью команды *commit*.
	[[Опасности использования read committed]]

- **[[Repeatable read]]** или snapshot isolation (Повторяемое чтение)  Видны только те данные, которые были зафиксированы до начала транзакции, но не видны незафиксированные данные и изменения, произведённые другими транзакциями в процессе выполнения данной транзакции.

>[!info]
>Гарантия того, что в процессе проведения транзакции **данные не будут изменены**.

- **[[Грязное чтение|Read uncommitted]]**  (Чтение незафиксированных данных) - Транзакция читает данные, записанные параллельной незавершённой транзакцией.

Уровни изоляции транзакций, описанные в стандарте SQL и реализованные в PostgreSQL

| Уровень изоляции                                  | «Грязное» чтение        | Неповторяемое чтение | Фантомное чтение        | Аномалия сериализации |
|---------------------------------------------------|-------------------------|----------------------|-------------------------|-----------------------|
| Read uncommited (Чтение незафиксированных данных) | Допускается, но не в PG | Возможно             | Возможно                | Возможно              |
| Read committed (Чтение зафиксированных данных)    | Невозможно              | Возможно             | Возможно                | Возможно              |
| Repeatable read (Повторяемое чтение)              | Невозможно              | Невозможно           | Допускается, но не в PG | Возможно              |
| Serializable (Сериализуемость)                    | Невозможно              | Невозможно           | Невозможно              | Невозможно            |

### Проблемы в многопользовательских БД

**Грязное чтение (Dirty Read)** - чтение данных, которые не были 

 **Фантомное чтение (Phantom Read)**: Это явление, когда во время параллельных транзакций одна транзакция выполняет чтение данных, а затем другая транзакция вставляет или удаляет записи, из-за чего первая транзакция видит новые строки при следующем чтении, "появляются" "фантомные" записи. 
 
 >[!info]
 >Ситуация при которой записи в базе уже не существуют, но информация о них еще хранится в транзакции

**Неповторяющееся чтение (Non-repeatable Read)**: Это ситуация, когда во время выполнения транзакции одни и те же данные читаются дважды, но в интервале между чтениями другая транзакция изменяет или удаляет эти данные, таким образом, первая транзакция видит разные значения при последующем чтении.

 >[!info]
 >Читаем 2 раза одни и те же данные и получаем разный результат
 
**Аномалия сериализации** - результат выполнения нескольких транзакций зависит от порядка их выполнения.

**[[Lost Update]]** Потерянное обновление