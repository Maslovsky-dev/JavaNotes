---
tags: Web
---
[Создание сертификата OpenSSL - Losst](https://losst.pro/sozdanie-sertifikata-openssl#%D0%A7%D1%82%D0%BE_%D1%82%D0%B0%D0%BA%D0%BE%D0%B5_%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D1%8B)
SSL (Secure Sockets Layer) сертификат — это цифровой сертификат, который используется для обеспечения шифрования данных между веб-браузером пользователя и веб-сервером. 

Для шифрования сообщения необходим только открытый ключ, для расшифровки - только закрытый. Ключи работают только в паре. Для определения подлинности ресурса используются авторитетные источники типа Comodo или LetsEncrypt

- **.pem, .crt, .cer** - готовый, подписанный центром сертификации сертификат, расширения разные, но означают одно и то же. Если совсем просто, то сертификат, это подписанный открытый ключ, плюс немного информации о вашей компании;
- **.key** - закрытый или открытый ключ;
- **.csr** - запрос на подпись сертификата, в этом файле хранится ваш открытый ключ плюс информация, о компании и домене, которую вы указали.
## OpenSSL
Одна из самых популярных свободных программ для создания сертификатов - это OpenSSL. Это утилита командной строки, которая позволяет создавать различные виды сертификатов, например, PKI или HTTPS.
### Создание закрытого ключа

В этой статье я буду использовать папку ~/certs для создания сертификатов. Вы можете создать эту папку и сразу перейти в неё с помощью команды:

`mkdir ~/certs && cd ~/certs`

Прежде всего необходимо создать закрытый ключ для сертификата. Для этого нужно использовать команду **genrsa**:

`openssl genrsa -out domain.key 2048`

Ей необходимо передать имя файла ключа с помощью опции -out. Вы можете выбрать любое имя, оно не имеет значения. Также можно указать размер ключа, например 2048. Если этого не сделать, то будет создан ключ размером 512 бит. Все ключи размером меньше 512 бит считаются небезопасными. После выполнения команды в текущей папке появится файл ключа:

![](https://losst.pro/wp-content/uploads/2022/10/create-openssl-12-832x576.png)

Для того чтобы получить сертификат, который можно использовать нужно этот ключ подписать. А для этого надо создать запрос на подпись.

### Создание запроса на подпись

При создании запроса на подпись нужно указать необходимую информацию. Обязательное поле здесь только одно. Это CN. Здесь должно быть указанно ваше доменное имя, для которого вы собираетесь использовать сертификат, также можно указать дополнительную информацию о вашей компании, адресе и организации, но это уже необязательно. Для создания запроса на подпись для ранее созданного ключа используйте такую команду:

`openssl req -key domain.key -new -out domain.csr`

Во время создания запроса большинство параметров можно оставить по умолчанию. Обязательно заполнять только **Common Name (e.g. server FQDN or YOUR name).** Если вы хотите создать сертификат для сайта, то в этом поле нужно указать домен этого сайта. В этом примере будет создан сертификат для localhost:

![](https://losst.pro/wp-content/uploads/2022/10/create-openssl-13-832x576.png)

### Подпись сертификатов OpenSSL

Допустим, у вас есть приватный ключ и запрос на подпись, фактически, открытый ключ. Теперь вам **нужно его подписать** чтобы получить сертификат, который можно использовать. 

Тут есть несколько вариантов. Можно:
-  отправить csr файл на подпись какому-либо центру сертификации, например, LetsEncrypt
-  подписать сертификат тем же ключом, с помощью которого он был создан
-  создать свой центр сертификации.

### Подпись сертификата самим собой

Мы подпишем наш сертификат сами, ключом, на основе которого он был создан:

`openssl x509 -signkey domain.key -in domain.csr -req -days 365 -out domain.crt`

С помощью параметра **-days** мы указываем что сертификат будет действительным в течение 365 дней, то есть в течение года. Обратите внимание, что во время подписи проверяется CN, поэтому если вы не зададите этот параметр на этапе создания запроса на подпись, то ничего не заработает.

![](https://losst.pro/wp-content/uploads/2022/10/create-openssl-15-832x576.png)


##  Let's Encrypt
Команда для ручного получения сертификата
проверки. Пример команды:
```bash
certbot certonly --manual --preferred-challenges dns -d ваш_домен
```

>[!Info] Сертификат нужен также для поддомена на котором работает сайт. 
>Например www.example.org

## Настройка Tomcat для работы с hhtps протоколом
Пример настройки для Spring Boot приложения

**Создание PKCS12-конверта:**

Ваш сервер Tomcat будет требовать ключи в формате PKCS12. Для начала, объедините ваши файлы ключа и цепочки сертификатов в один PKCS12-конверт. Вы можете сделать это с помощью команды OpenSSL:

```bash
openssl pkcs12 -export -in fullchain.pem -inkey privkey.pem -out keystore.p12 -name tomcat -CAfile fullchain.pem -caname root
```
Вас попросят задать пароль для нового PKCS12-конверта (`keystore.p12`).

**Перемещение PKCS12-конверта:**

Переместите созданный `keystore.p12` в каталог проекта, где хранятся ключи и сертификаты, например, в папку `conf`.

 **Настройка  сервера Tomcat (`application.properties`):**
```properties
server.port=8443
server.ssl.key-store-type=PKCS12
server.ssl.key-store=classpath:keystore.p12
server.ssl.key-store-password=ваш_пароль
```
